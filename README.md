## 🏪 편의점 관리 시스템 - 우아한 테크 프리코스 4주차 프로젝트

> **편의점 시스템 프로젝트**는 편의점 상품 관리, 프로모션 적용, 장바구니 기능, 결제 및 영수증 발행까지 편의점 운영의 흐름을 구현한 프로그램입니다. 각 기능을 객체지향 설계와 다양한 디자인 패턴으로 구성하여 독립적이고 유지 보수성이 높은 프로그램을 목표로 개발했습니다.

---

## 📖 목차
1. [도메인 설계](#-도메인-설계)
2. [전체 기능 명세](#-전체-기능-명세)
2. [시스템 흐름](#-시스템-흐름)
3. [주요 로직 및 디자인 패턴](#-주요-로직-및-디자인-패턴)
4. [단계별 책임 분리](#-단계별-책임-분리)
5. [시간 고정 테스트](#-시간-고정-테스트)
6. [설치 및 실행 방법](#-설치-및-실행-방법)

---

## 🏗 도메인 설계

편의점 운영에 필요한 요소들을 객체로 표현하였으며, 필요한 로직을 캡슐화하여 유지 보수성을 높였습니다.

| 도메인 | 클래스 명 | 설명 |
|--------|-----------|------|
| **상품** | `Product` | 상품의 기본 정보(이름, 가격) 관리 및 출력 기능 |
| **재고** | `Stock` | 특정 상품의 재고 수량 관리 및 품절 여부 확인 |
| **프로모션 재고** | `PromotionStock` | 프로모션 조건을 가진 재고 관리 |
| **재고 관리** | `Inventory` | 모든 상품과 프로모션 재고를 통합 관리 |
| **장바구니** | `Cart` | 사용자 장바구니 내 상품 목록을 관리 |
| **장바구니 항목** | `CartItem` | 개별 상품 항목과 수량 조정 기능 포함 |
| **가격** | `Price` | 가격 연산(곱셈, 덧셈, 백분율) 및 포맷 |
| **프로모션** | `Promotion` | 특정 상품에 적용할 프로모션 정의 및 검증 |
| **영수증** | `Receipt` | 구매 내역과 총액, 할인금액 계산 및 출력 |
| **주문** | `Order` | 주문 정보 관리 및 주문 항목 생성 |
| **주문 항목** | `OrderItem` | 장바구니 항목을 주문 항목으로 변환 |
| **결제** | `Payment` | 결제 정보 및 할인 계산 관리 |
| **결제 항목** | `PaymentItem` | 개별 결제 항목 및 할인 금액 관리 |
| **프로모션 정책** | `PromotionPolicy` | 프로모션 조건 정의 및 조건 충족 여부 |

---
## 📜 전체 기능 명세

### 1. **상품 및 재고 관리**
- **상품 관리**: 상품은 이름과 가격을 기준으로 관리되며, 각 상품의 재고 수량도 함께 관리됩니다.
- **재고 관리**: 상품의 재고는 구매 시 차감되며, 재고가 부족할 경우 구매할 수 없습니다. 재고는 상품별로 관리됩니다.

### 2. **장바구니 및 주문**
- **장바구니**: 사용자가 선택한 상품은 장바구니에 담기며, 상품의 수량과 가격이 표시됩니다.
- **주문 생성**: 장바구니에 담긴 상품을 바탕으로 주문이 생성됩니다. 주문 생성 시 프로모션 조건을 적용하여 할인 혜택을 계산합니다.

### 3. **결제 시스템**
- **최종 결제 금액 계산**: 사용자가 입력한 상품의 가격과 수량을 바탕으로 결제 금액이 계산되며, 프로모션 및 멤버십 할인 정책이 반영됩니다.
- **영수증 출력**: 결제 후 영수증을 출력하며, 구매 내역과 최종 결제 금액이 안내됩니다.
- **잘못된 입력 처리**: 사용자가 잘못된 값을 입력할 경우 `IllegalArgumentException`을 발생시키며, 적절한 오류 메시지를 출력하고 다시 입력을 받습니다.

### 4. **프로모션 및 할인 정책**
- **프로모션 적용**: 프로모션은 'Buy N Get 1 Free' 형태로 제공됩니다. 오늘 날짜가 프로모션 기간 내에 포함될 경우 해당 프로모션이 적용됩니다.
- **프로모션 재고 차감**: 프로모션이 적용되는 상품은 프로모션 재고에서 우선 차감되며, 프로모션 재고가 부족한 경우 일반 재고에서 차감됩니다.
- **프로모션 안내**: 프로모션 적용 대상 상품에 대해 필요한 수량을 더 추가로 구매할 경우 혜택을 받을 수 있도록 안내합니다.

### 5. **에러 처리 및 예외**
- **잘못된 입력 처리**: 사용자가 잘못된 값을 입력하면 `IllegalArgumentException`을 발생시키며, 오류 메시지를 출력하고 올바른 입력을 유도합니다.
- **유효하지 않은 상태**: 프로모션 조건이 충족되지 않거나, 재고가 부족한 경우 적절한 예외를 발생시켜 처리합니다.

### 6. **기타**
- **추가 구매 또는 종료 선택**: 영수증 출력 후 추가 구매를 할지 또는 종료할지를 사용자에게 선택할 수 있도록 합니다.
---
## 🔄 시스템 흐름

### 전체 흐름
1. **파일 읽기**
    - `promotions.md` 파일을 통해 프로모션 로직을 설정하고, `products.md`를 사용하여 `Inventory`를 구성합니다.
2. **카트에 상품 담기**
    - 사용자가 상품을 장바구니에 추가하고, 재고를 확인합니다.
3. **주문 생성**
    - 프로모션 조건에 따라 혜택 적용 여부를 판별합니다.
        - 프로모션 조건:
            1. n+1 행사 상품 포함 여부
            2. 정가로 결제해야 하는 상품 유무
4. **결제 처리**
    - 멤버십 할인 적용 여부에 따라 최종 결제 금액을 계산합니다.
5. **영수증 발행**
    - 최종 결제 완료 후 영수증을 생성하여 출력합니다.

---

## 🧩 주요 로직 및 디자인 패턴

### 1. **Callback Interface**로 입력 제어
- `Order`에서 분기별 입력 제어에 **Callback 패턴**을 사용하여 결합도를 낮추고 유연성을 높였습니다.

### 2. **Strategy 패턴**으로 프로모션 전략 적용
- 각 프로모션에 맞는 전략을 **팩토리 및 전략 패턴**으로 적용하여 유지보수성을 강화했습니다.

### 3. **싱글톤 패턴**으로 `InventoryExtension` 설정
- `Inventory`를 싱글톤으로 구성하여, 테스트 시 자동으로 데이터를 주입하여 테스트 효율성을 높였습니다.

---

## ⚙️ 단계별 책임 분리

1. **상품 조회 및 선택** - 사용자가 상품을 선택하고 장바구니에 추가합니다.
2. **재고 확인 및 프로모션 적용** - 상품의 재고를 확인하고, 프로모션 조건을 충족하는지 검증합니다.
3. **장바구니 구성** - 선택된 상품과 수량을 바탕으로 장바구니가 구성됩니다.
4. **주문 생성** - 장바구니를 바탕으로 주문을 생성하고, 프로모션 조건에 따라 혜택을 적용합니다.
5. **결제** - 총액 및 할인 금액을 계산하여 결제를 완료합니다.
6. **영수증 발행** - 결제 후 영수증을 출력합니다.

이 구조를 통해 코드의 가독성 및 유지 보수성을 한층 더 향상시켰습니다.

---

## 🕒 시간 고정 테스트

시간 의존 로직 테스트를 위해 `DateTimeGenerator`를 사용하여 `fixedMode`와 `nonFixedMode`로 시간을 제어합니다. 이를 통해 시간에 민감한 기능을 일관되게 테스트할 수 있습니다.

---

## 💻 설치 및 실행 방법

1. **클론**  
   프로젝트를 클론합니다:
   ```bash
   git clone https://github.com/KNU-K/java-convenience-store-7-KNU-K
   ```

2. **빌드 및 실행**  
   Gradle을 사용해 프로젝트를 빌드 및 실행합니다:
   ```bash
   ./gradlew build
   ./gradlew run
   ```

3. **테스트 실행**  
   모든 테스트를 실행합니다:
   ```bash
   ./gradlew test
   ```